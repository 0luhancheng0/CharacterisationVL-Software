Bootstrap: shub
From: Characterisation-Virtual-Laboratory/CharacterisationVL-Software:1804-cuda10.1

%environment
    PATH=/opt/conda/bin:$PATH
    . /opt/conda/etc/profile.d/conda.sh
    conda activate base
    export PATH
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8

%post
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8
    apt update -y
    apt  install -y build-essential
    apt install -y git curl vim wget tar bzip2 gzip
    wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
    bash Miniconda3-latest-Linux-x86_64.sh -b -p /opt/conda
    export PATH=/opt/conda/bin:$PATH
    conda install -y conda
    conda update -y conda
    wget https://data.qiime2.org/distro/core/qiime2-2020.6-py36-linux-conda.yml
    . /opt/conda/etc/profile.d/conda.sh
    conda activate base
    conda env update --file qiime2-2020.6-py36-linux-conda.yml
    pip install numpy
    pip install git+https://github.com/biocore/mmvec.git
    pip install tensorflow-gpu==1.15.0
    qiime dev refresh-cache

%runscript
    exec qiime "$@"
